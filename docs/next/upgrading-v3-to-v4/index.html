<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135618258-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-135618258-1",{})</script>
<script src="/js/custom.js"></script>

<title data-react-helmet="true">Upgrading from v3 to v4 | MikroORM</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="MikroORM"><meta data-react-helmet="true" name="docsearch:version" content="next"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="Following sections describe (hopefully) all breaking changes, most of them might be not valid "><meta data-react-helmet="true" property="og:description" content="Following sections describe (hopefully) all breaking changes, most of them might be not valid "><meta data-react-helmet="true" property="og:url" content="https://mikro-orm.io/docs/next/upgrading-v3-to-v4">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.bc8338fb.css">


<link rel="preload" href="/styles.97cd1eb9.js" as="script">

<link rel="preload" href="/runtime~main.9f0fc6fe.js" as="script">

<link rel="preload" href="/main.cad4d1e3.js" as="script">

<link rel="preload" href="/1.8709b7ad.js" as="script">

<link rel="preload" href="/2.cea24bbb.js" as="script">

<link rel="preload" href="/3.f8c69094.js" as="script">

<link rel="preload" href="/1be78505.66fd105f.js" as="script">

<link rel="preload" href="/c6c6e257.6fdc6b3c.js" as="script">

<link rel="preload" href="/17896441.6776b76e.js" as="script">

<link rel="preload" href="/9b3b49c0.7dd386c9.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}function e(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}var n=window.matchMedia("(prefers-color-scheme: dark)");n.addListener((function(n){null===e()&&t(n.matches?"dark":"")}));var a=e();null!==a?t(a):n.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="MikroORM"><strong></strong></a><a class="navbar__item navbar__link" data-type="versions" href="/versions">3.6.15</a><a class="navbar__item navbar__link" href="/docs/installation">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA" title="Chat on Slack">Slack</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/mikro-orm/mikro-orm" title="View on GitHub">GitHub</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/MikroORM" title="Twitter">Twitter</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="MikroORM"><strong></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" data-type="versions" href="/versions">3.6.15</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA" title="Chat on Slack">Slack</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/mikro-orm/mikro-orm" title="View on GitHub">GitHub</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/MikroORM" title="Twitter">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><span style="vertical-align:top" class="badge badge--info">Version: next</span><header><h1 class="docTitle_1vWb">Upgrading from v3 to v4</h1></header><div class="markdown"><p>Following sections describe (hopefully) all breaking changes, most of them might be not valid
for you, like if you do not use custom <code>NamingStrategy</code> implementation, you do not care about
the interface being changed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="node-10130-required"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#node-10130-required" title="Direct link to heading">#</a>Node 10.13.0+ required</h2><p>Support for older node versions was dropped. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="typescript-37-required"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#typescript-37-required" title="Direct link to heading">#</a>TypeScript 3.7+ required</h2><p>Support for older TypeScript versions was dropped. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="monorepo"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#monorepo" title="Direct link to heading">#</a>Monorepo</h2><p>The ORM has been split into several packages. In v4 one needs to require
<code>@mikro-orm/core</code> and a driver package, e.g. <code>@mikro-orm/mysql</code>. This driver
package already contains the <code>mysql2</code> dependency, so you can remove that from
your <code>package.json</code>. </p><ul><li><code>@mikro-orm/core</code></li><li><code>@mikro-orm/reflection</code> - <code>TsMorphMetadataProvider</code></li><li><code>@mikro-orm/cli</code> - CLI support, requires entity-generator, migrator and knex</li><li><code>@mikro-orm/knex</code> - SQL support</li><li><code>@mikro-orm/entity-generator</code></li><li><code>@mikro-orm/migrations</code></li><li><code>@mikro-orm/mysql</code></li><li><code>@mikro-orm/mariadb</code></li><li><code>@mikro-orm/mysql-base</code> - Common implementation for mysql and mariadb (internal)</li><li><code>@mikro-orm/sqlite</code></li><li><code>@mikro-orm/postgresql</code></li><li><code>@mikro-orm/mongodb</code></li></ul><blockquote><p>For easier transition, meta package mikro-orm is still present, reexporting
core, reflection, migrations, entity-generator and cli packages. You should
<strong>not</strong> install both <code>mikro-orm</code> and <code>@mikro-orm/core</code> packages together. </p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="sqlentitymanager-and-mongoentitymanager"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#sqlentitymanager-and-mongoentitymanager" title="Direct link to heading">#</a>SqlEntityManager and MongoEntityManager</h2><p>In v4 the <code>core</code> package, where <code>EntityManager</code> and <code>EntityRepository</code> are
defined, is not dependent on knex, and therefore it cannot have a method
returning a <code>QueryBuilder</code>. You need to import the SQL flavour of the EM
from the driver package to access the <code>createQueryBuilder()</code> method.</p><blockquote><p>The SQL flavour of EM is actually called <code>SqlEntityManager</code>, it is exported both under
this name and under <code>EntityManager</code> alias, so you can just change the
location from where you import.</p></blockquote><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-typescript codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">EntityManager</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@mikro-orm/mysql&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// or any other SQL driver package</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token maybe-class-name">EntityManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> qb </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createQueryBuilder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></code></pre></div><p>Same applies for the <code>aggregate()</code> method in mongo driver:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-typescript codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">EntityManager</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@mikro-orm/mongodb&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token maybe-class-name">EntityManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">aggregate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></code></pre></div><blockquote><p>The mongo flavour of EM is actually called <code>MongoEntityManager</code>, it is exported both under
this name and under <code>EntityManager</code> alias, so you can just change the
location from where you import.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="different-default-pivottable"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#different-default-pivottable" title="Direct link to heading">#</a>Different default <code>pivotTable</code></h2><p>Implementation of <code>UnderscoreNamingStrategy</code> and <code>EntityCaseNamingStrategy</code>
<code>joinTableName()</code> method has changed. You can use <code>pivotTable</code> on the owning side
of M:N relation to specify the table name manually. </p><p>Previously the table name did not respect property name, if one defined multiple
M:N relations between same entities, there were conflicts and one would have to
specify <code>pivotTable</code> name manually at least on one of them. With the new way,
we can be sure that the table name won&#x27;t conflict with other pivot tables. </p><p>Previously the name was constructed from 2 entity names as <code>entity_a_to_entity_b</code>,
ignoring the actual property name. In v4 the name will be <code>entity_a_coll_name</code> in
case of the collection property on the owning side being named <code>collName</code>. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="changes-in-folder-based-discovery-entitiesdirs-removed"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#changes-in-folder-based-discovery-entitiesdirs-removed" title="Direct link to heading">#</a>Changes in folder-based discovery (<code>entitiesDirs</code> removed)</h2><p><code>entitiesDirs</code> and <code>entitiesDirsTs</code> were removed in favour of <code>entities</code> and <code>entitiesTs</code>,
<code>entities</code> will be used as a default for <code>entitiesTs</code> (that is used when we detect <code>ts-node</code>).</p><p><code>entities</code> can now contain mixture of paths to directories, globs pointing to entities,
or references to the entities or instances of <code>EntitySchema</code>. </p><p>This basically means that all you need to change is renaming <code>entitiesDirs</code> to <code>entities</code>.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-typescript codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token maybe-class-name">MikroORM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  entities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;dist/**/entities&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;dist/**/*.entity.js&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">FooBar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">FooBaz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  entitiesTs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;src/**/entities&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;src/**/*.entity.ts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">FooBar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token maybe-class-name">FooBaz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="changes-in-wrap-helper-wrappedentity-interface-and-reference-wrapper"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#changes-in-wrap-helper-wrappedentity-interface-and-reference-wrapper" title="Direct link to heading">#</a>Changes in <code>wrap()</code> helper, <code>WrappedEntity</code> interface and <code>Reference</code> wrapper</h2><p>Previously all the methods and properties of <code>WrappedEntity</code> interface were
added to the entity prototype during discovery. In v4 there is only one property
added: <code>__helper: WrappedEntity</code>. <code>WrappedEntity</code> has been converted to actual class.</p><p><code>wrap(entity)</code> no longer returns the entity, now the <code>WrappedEntity</code> instance is
being returned. It contains only public methods (<code>init</code>, <code>assign</code>, <code>isInitialized</code>, ...),
if you want to access internal properties like <code>__meta</code> or <code>__em</code>, you need to explicitly
ask for the helper via <code>wrap(entity, true)</code>.</p><p>Internal methods (with <code>__</code> prefix) were also removed from the <code>Reference</code> class,
use <code>wrap(ref, true)</code> to access them. </p><p>Instead of interface merging with <code>WrappedEntity</code>, one can now use classic inheritance,
by extending <code>BaseEntity</code> exported from <code>@mikro-orm/core</code>. If you do so, <code>wrap(entity)</code>
will return your entity. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="removed-flush-parameter-from-persist-and-remove-methods"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#removed-flush-parameter-from-persist-and-remove-methods" title="Direct link to heading">#</a>Removed <code>flush</code> parameter from <code>persist()</code> and <code>remove()</code> methods</h2><p><code>persist()</code> and <code>remove()</code> are now sync methods that only mark the entity for
persistence or removal. They now return the <code>EntityManager</code> to allow fluid flushing:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-typescript codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// before</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">persist</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">jon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> jon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// after</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">persist</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">jon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">flush</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">jon</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">flush</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="remove-method-requires-entity-instances"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#remove-method-requires-entity-instances" title="Direct link to heading">#</a><code>remove()</code> method requires entity instances</h2><p>The <code>em.remove()</code> method originally allowed to pass either entity instance, or
a condition. When one passed a condition, it was firing a native delete query,
without handling transactions or hooks. </p><p>In v4, the method is now simplified and works only with entity instances. Use
<code>em.nativeDelete()</code> explicitly if you want to fire a delete query instead of
letting the <code>UnitOfWork</code> doing its job.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-typescript codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// before</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// fires query directly</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// after </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">nativeDelete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></code></pre></div><blockquote><p><code>em.removeEntity()</code> has been removed in favour of <code>em.remove()</code> (that now has almost the same signature).</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="type-safe-references"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#type-safe-references" title="Direct link to heading">#</a>Type safe references</h2><p>EM now returns <code>Loaded&lt;T, P&gt;</code> instead of the entity (<code>T</code>). This type automatically
adds synchronous method <code>get()</code> that returns the entity (for references) or array
of entities (for collections).</p><p><code>Reference.get()</code> is now available only with correct <code>Loaded</code> type hint and is used
as a sync getter for the entity, just like <code>unwrap()</code>. You can use <code>Reference.load(prop)</code>
for the original <code>get()</code> method functionality. </p><p><code>em.find()</code> and similar methods now have two type arguments, due to TypeScript not supporting partial
type inference, when you specify the <code>T</code> explicitly (without also explicitly
specifying the load hint), the inference will not work. This use case was mainly
for usage without classes (interfaces + <code>EntitySchema</code>) - in that case it is now
supported to pass actual instance of <code>EntitySchema</code> as the first parameter to these
methods, that will allow correct type inference:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-typescript codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> author </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">findOne</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">AuthorSchema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;books&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 107)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">author</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">books</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// `get()` is now inferred correctly</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="custom-types-are-now-type-safe"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom-types-are-now-type-safe" title="Direct link to heading">#</a>Custom types are now type safe</h2><p>Generic <code>Type</code> class has now two type arguments - the input and output types.
Input type defaults to <code>string</code>, output type defaults to the input type. </p><p>You might need to explicitly provide the types if your methods are strictly typed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="custom-type-serialization"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom-type-serialization" title="Direct link to heading">#</a>Custom type serialization</h2><p>Custom types used to be serialized to the database value. In v4, the runtime
value is used by default. Implement custom <code>toJSON()</code> method if you need to
customize this.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="property-default-and-defaultraw"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#property-default-and-defaultraw" title="Direct link to heading">#</a>Property <code>default</code> and <code>defaultRaw</code></h2><p>Previously the <code>default</code> option of properties was used as is, so we had to wrap
strings in quotes (e.g. <code>@Property({ default: &quot;&#x27;foo bar&#x27;&quot; })</code>). </p><p>In v4 the <code>default</code> is typed as <code>string | number | boolean | null</code> and when used
with string value, it will be automatically quoted. </p><p>To use SQL functions we now need to use <code>defaultRaw</code>: <code>@Property({ defaultRaw: &#x27;now()&#x27; })</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="autoflush-option-has-been-removed"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#autoflush-option-has-been-removed" title="Direct link to heading">#</a><code>autoFlush</code> option has been removed</h2><p>The <code>flush</code> parameter of <code>persist()</code> and <code>remove()</code> methods is still there, but you
should prefer to call <code>em.flush()</code> explicitly. </p><p>Also <code>persistLater()</code> and <code>removeLater()</code> methods are deprecated. Use <code>persist()</code> or
<code>remove</code> respectively.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="identity-uuidentity-and-mongoentity-interfaces-are-removed"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#identity-uuidentity-and-mongoentity-interfaces-are-removed" title="Direct link to heading">#</a><code>IdEntity</code>, <code>UuidEntity</code> and <code>MongoEntity</code> interfaces are removed</h2><p>They were actually never needed. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="mongodb-driver-is-no-longer-the-default"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#mongodb-driver-is-no-longer-the-default" title="Direct link to heading">#</a>MongoDB driver is no longer the default</h2><p>You need to specify the platform type either via <code>type</code> option or provide the driver
implementation via <code>driver</code> option. </p><p>Available platforms types: <code>[ &#x27;mongo&#x27;, &#x27;mysql&#x27;, &#x27;mariadb&#x27;, &#x27;postgresql&#x27;, &#x27;sqlite&#x27; ]</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="removed-configuration-discoverytsconfigpath"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#removed-configuration-discoverytsconfigpath" title="Direct link to heading">#</a>Removed configuration <code>discovery.tsConfigPath</code></h2><p>Removed as it is no longer needed, it was used only for <code>TsMorphMetadataProvider</code>,
when the <code>entitiesDirsTs</code> were not explicitly provided. In v4, this is no longer
needed, as ts-morph discovery will use <code>d.ts</code> files instead, that should be located
next to the compiled entities. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="changes-in-query-highlighting"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#changes-in-query-highlighting" title="Direct link to heading">#</a>Changes in query highlighting</h2><p>Previously Highlight.js was used to highlight various things in the CLI,
like SQL and mongo queries, or migrations or entities generated via CLI.
While the library worked fine, it was causing performance issues mainly
for those bundling via webpack and using lambdas, as the library was huge.</p><p>In v4 highlighting is disabled by default, and there are 2 highlighters
you can optionally use (you need to install them first).</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-typescript codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token maybe-class-name">SqlHighlighter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@mikro-orm/sql-highlighter&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token maybe-class-name">MikroORM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  highlighter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">SqlHighlighter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></code></pre></div><p>For MongoDB you can use <code>@mikro-orm/mongo-highlighter</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/mikro-orm/mikro-orm/edit/master/docs/docs/upgrading-v3-to-v4.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#node-10130-required" class="contents__link">Node 10.13.0+ required</a></li><li><a href="#typescript-37-required" class="contents__link">TypeScript 3.7+ required</a></li><li><a href="#monorepo" class="contents__link">Monorepo</a></li><li><a href="#sqlentitymanager-and-mongoentitymanager" class="contents__link">SqlEntityManager and MongoEntityManager</a></li><li><a href="#different-default-pivottable" class="contents__link">Different default <code>pivotTable</code></a></li><li><a href="#changes-in-folder-based-discovery-entitiesdirs-removed" class="contents__link">Changes in folder-based discovery (<code>entitiesDirs</code> removed)</a></li><li><a href="#changes-in-wrap-helper-wrappedentity-interface-and-reference-wrapper" class="contents__link">Changes in <code>wrap()</code> helper, <code>WrappedEntity</code> interface and <code>Reference</code> wrapper</a></li><li><a href="#removed-flush-parameter-from-persist-and-remove-methods" class="contents__link">Removed <code>flush</code> parameter from <code>persist()</code> and <code>remove()</code> methods</a></li><li><a href="#remove-method-requires-entity-instances" class="contents__link"><code>remove()</code> method requires entity instances</a></li><li><a href="#type-safe-references" class="contents__link">Type safe references</a></li><li><a href="#custom-types-are-now-type-safe" class="contents__link">Custom types are now type safe</a></li><li><a href="#custom-type-serialization" class="contents__link">Custom type serialization</a></li><li><a href="#property-default-and-defaultraw" class="contents__link">Property <code>default</code> and <code>defaultRaw</code></a></li><li><a href="#autoflush-option-has-been-removed" class="contents__link"><code>autoFlush</code> option has been removed</a></li><li><a href="#identity-uuidentity-and-mongoentity-interfaces-are-removed" class="contents__link"><code>IdEntity</code>, <code>UuidEntity</code> and <code>MongoEntity</code> interfaces are removed</a></li><li><a href="#mongodb-driver-is-no-longer-the-default" class="contents__link">MongoDB driver is no longer the default</a></li><li><a href="#removed-configuration-discoverytsconfigpath" class="contents__link">Removed configuration <code>discovery.tsConfigPath</code></a></li><li><a href="#changes-in-query-highlighting" class="contents__link">Changes in query highlighting</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Installation &amp; Usage</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/mikro-orm/mikro-orm#-quick-start">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/upgrading-v3-to-v4">Migration from v3 to v4</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Version 3.6 docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA">Slack</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/ask?tags=mikro-orm">Stack Overflow</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" to="https://twitter.com/MikroOrm" href="https://twitter.com/MikroOrm">Twitter</a></li><li class="footer__item"><iframe src="https://ghbtns.com/github-btn.html?user=mikro-orm&amp;repo=mikro-orm&amp;type=star&amp;count=true" style="margin-top:10px" frameborder="0" scrolling="0" width="100" height="30" title="GitHub Stars"></iframe></li><li class="footer__item"><iframe src="https://ghbtns.com/github-btn.html?user=B4nan&amp;type=sponsor" frameborder="0" scrolling="0" width="130" height="30" title="Sponsor B4nan"></iframe></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="MikroORM" src="/img/logo-header.svg"></div>Copyright © 2018-2020 Martin Adámek. Built with Docusaurus. Icons made by <a href="https://www.flaticon.com/authors/surang" title="surang">surang</a> and <a href="https://www.flaticon.com/authors/skyclick" title="Skyclick">Skyclick</a>.</div></div></footer>
</div>

<script src="/styles.97cd1eb9.js"></script>

<script src="/runtime~main.9f0fc6fe.js"></script>

<script src="/main.cad4d1e3.js"></script>

<script src="/1.8709b7ad.js"></script>

<script src="/2.cea24bbb.js"></script>

<script src="/3.f8c69094.js"></script>

<script src="/1be78505.66fd105f.js"></script>

<script src="/c6c6e257.6fdc6b3c.js"></script>

<script src="/17896441.6776b76e.js"></script>

<script src="/9b3b49c0.7dd386c9.js"></script>


</body>
</html>